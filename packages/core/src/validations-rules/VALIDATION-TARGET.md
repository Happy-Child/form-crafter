Вот описание сложных валидаций, где осуществляется зависимость между полями:

- Поля "Контактная информация": хотя бы одно поле из "Телефон", "Email" должно быть заполнено.

- Зависимость от тарифа
  Если тариф "Базовый", то:

Максимальное количество пользователей — 5.
Длительность подписки — фиксированно 1 месяц.
Никакие дополнительные услуги не допускаются.
Если тариф "Премиум", то:

Количество пользователей от 1 до 50.
Длительность подписки может быть 1, 6 или 12 месяцев.
Допускаются любые дополнительные услуги.
Если тариф "Корпоративный", то:

Количество пользователей от 10 до 1000.
Длительность подписки — от 6 до 36 месяцев.
Дополнительные услуги: только "Техподдержка 24/7" и "Выделенный менеджер".

1. **Валидация зависимости бюджета**:
   Сумма нескольких полей должна быть равна фиксированному значению, например, сумма процентов бюджета для различных категорий (маркетинг, разработка, администрация, операции) должна составлять 100%.

2. **Валидация зависимости дат с несколькими полями**:
   Проверка последовательности дат — например, "Дата регистрации" должна быть меньше или равна "Дате начала", "Дата начала" должна быть меньше или равна "Дате окончания", и "Дата окончания" должна быть меньше или равна "Дате архивирования".

3. **Валидация на комбинации полей с учетом бизнес-логики**:
   Если хотя бы одно поле, например, "Тип документа", "Номер документа", "Дата документа" или "Организация", заполнено, то остальные поля также должны быть обязательными.

4. **Динамическая логика зависимостей**:
   Обязательность одного поля зависит от выбора другого. Например, если выбрана роль "Администратор", то поле "Доступы" обязательно для заполнения.

5. **Комплексное условие с числовыми ограничениями**:
   Проверка взаимосвязи между полями, например, "Средняя зарплата" должна быть между "Минимальной" и "Максимальной зарплатой", а "Минимальная зарплата" должна быть меньше "Максимальной".

6. **Валидация зависимых коэффициентов**:
   Сумма двух коэффициентов должна быть равна фиксированному значению общего коэффициента.

7. **Проверка уникальности значений**:
   Все указанные значения, например, коды, должны быть уникальными и их должно быть больше двух.

8. **Валидация зависимостей между парой значений**:
   Например, возраст должен быть в пределах от минимального до максимального возраста, и все три поля ("Минимальный возраст", "Максимальный возраст", "Возраст") должны быть заполнены, если указано хотя бы одно.

9. **Динамическая валидация списка объектов**:
   Каждый объект в списке должен содержать уникальную комбинацию идентификатора и типа.

10. **Зависимость от внешнего контекста**:
    Поле, например, "Целевая сумма", должно быть больше переданного значения из контекста, например, "Начальной суммы".

11. **Проверка соответствия структуры вложенных объектов**:
    Если присутствуют данные пользователя, то они должны содержать обязательные поля, такие как "Имя", "Email" и "Роль".

12. **Проверка взаимосвязанности полей по флагу**:
    Если флаг "Детали обязательны" установлен в `true`, то все связанные поля, такие как "Описание", "Причина" и "Источник", становятся обязательными.

13. **Сложная валидация ввода по условию**:
    Например, если выбрана категория "Финансы", то поле "Сумма" должно быть обязательным, а "Описание" должно содержать слово "оплата".

14. Валидация зависимости бюджета: Сумма нескольких полей должна быть равна фиксированному значению
    Например, "Маркетинг", "Разработка", "Администрация", "Операции" должны в сумме составлять 100% бюджета.

tsx
Копировать код
const schema = yup.object({
marketing: yup
.number()
.required('Укажите процент для маркетинга')
.min(0, 'Не может быть меньше 0%')
.max(100, 'Не может быть больше 100%'),
development: yup
.number()
.required('Укажите процент для разработки')
.min(0, 'Не может быть меньше 0%')
.max(100, 'Не может быть больше 100%'),
administration: yup
.number()
.required('Укажите процент для администрации')
.min(0, 'Не может быть меньше 0%')
.max(100, 'Не может быть больше 100%'),
operations: yup
.number()
.required('Укажите процент для операций')
.min(0, 'Не может быть меньше 0%')
.max(100, 'Не может быть больше 100%'),
}).test('total-budget', 'Сумма всех значений должна быть равна 100%', function (values) {
const { marketing, development, administration, operations } = values;
const total = (marketing ?? 0) + (development ?? 0) + (administration ?? 0) + (operations ?? 0);
return total === 100;
}); 2. Валидация зависимости дат с несколькими полями
Проверка последовательности событий: "Дата регистрации" ≤ "Дата начала" ≤ "Дата окончания" ≤ "Дата архивирования".

tsx
Копировать код
const schema = yup.object({
registrationDate: yup
.date()
.required('Дата регистрации обязательна'),
startDate: yup
.date()
.required('Дата начала обязательна')
.test('is-after-registration', 'Дата начала должна быть после регистрации', function (value) {
const { registrationDate } = this.parent;
return registrationDate && value && new Date(value) >= new Date(registrationDate);
}),
endDate: yup
.date()
.required('Дата окончания обязательна')
.test('is-after-start', 'Дата окончания должна быть после начала', function (value) {
const { startDate } = this.parent;
return startDate && value && new Date(value) >= new Date(startDate);
}),
archiveDate: yup
.date()
.required('Дата архивирования обязательна')
.test('is-after-end', 'Дата архивирования должна быть после окончания', function (value) {
const { endDate } = this.parent;
return endDate && value && new Date(value) >= new Date(endDate);
}),
}); 3. Валидация на комбинации полей с учетом бизнес-логики
Поля "Тип документа", "Номер документа", "Дата документа", "Организация" — если задан один, то остальные тоже обязательны.

tsx
Копировать код
const schema = yup.object({
documentType: yup
.string()
.nullable(),
documentNumber: yup
.string()
.nullable(),
documentDate: yup
.date()
.nullable(),
organization: yup
.string()
.nullable(),
}).test('all-or-none', 'Если заполнено одно из полей документа, остальные тоже должны быть заполнены', function (values) {
const { documentType, documentNumber, documentDate, organization } = values;
const filledFields = [documentType, documentNumber, documentDate, organization].filter(Boolean).length;
return filledFields === 0 || filledFields === 4;
}); 4. Динамическая логика зависимостей: Поле влияет на обязательность других полей
Если выбрана "Роль пользователя" = "Администратор", тогда "Доступы" должны быть указаны. Если "Роль" = "Пользователь", "Доступы" не требуются.

tsx
Копировать код
const schema = yup.object({
role: yup
.string()
.required('Роль обязательна'),
permissions: yup
.array()
.of(yup.string())
.when('role', {
is: 'admin',
then: yup.array().min(1, 'Укажите хотя бы один доступ для администратора'),
otherwise: yup.array(),
}),
}); 5. Комплексное условие с числовыми ограничениями
Поля "Минимальная зарплата", "Максимальная зарплата" и "Средняя зарплата":

Средняя зарплата должна быть между минимальной и максимальной.
Минимальная < Максимальная.
tsx
Копировать код
const schema = yup.object({
minSalary: yup
.number()
.required('Укажите минимальную зарплату')
.min(0, 'Не может быть меньше 0'),
maxSalary: yup
.number()
.required('Укажите максимальную зарплату')
.test('is-greater-than-min', 'Максимальная зарплата должна быть больше минимальной', function (value) {
const { minSalary } = this.parent;
return minSalary !== undefined && value !== undefined && value > minSalary;
}),
avgSalary: yup
.number()
.required('Укажите среднюю зарплату')
.test('is-between', 'Средняя зарплата должна быть между минимальной и максимальной', function (value) {
const { minSalary, maxSalary } = this.parent;
return minSalary !== undefined && maxSalary !== undefined && value >= minSalary && value <= maxSalary;
}),
});

6. Валидация зависимых коэффициентов
   Сумма "Коэффициента первого" и "Коэффициента второго" должна быть равна "Общему коэффициенту", который фиксирован.

tsx
Копировать код
const schema = yup.object({
coefficient1: yup
.number()
.required('Укажите первый коэффициент')
.min(0, 'Коэффициент не может быть отрицательным'),
coefficient2: yup
.number()
.required('Укажите второй коэффициент')
.min(0, 'Коэффициент не может быть отрицательным'),
totalCoefficient: yup
.number()
.required('Укажите общий коэффициент')
.test('sum-check', 'Сумма коэффициентов должна быть равна общему коэффициенту', function (value) {
const { coefficient1, coefficient2 } = this.parent;
return value === (coefficient1 ?? 0) + (coefficient2 ?? 0);
}),
}); 7. Проверка уникальности значений
Все указанные "Коды" должны быть уникальными, и их должно быть больше двух.

tsx
Копировать код
const schema = yup.object({
codes: yup
.array()
.of(yup.string().required('Код не может быть пустым'))
.min(3, 'Должно быть указано хотя бы три кода')
.test('unique-codes', 'Все коды должны быть уникальными', function (value) {
return value && new Set(value).size === value.length;
}),
}); 8. Валидация зависимостей между парой значений
"Возраст" должен быть в диапазоне "Минимального возраста" и "Максимального возраста", но все три значения должны быть заполнены, если указано хотя бы одно.

tsx
Копировать код
const schema = yup.object({
minAge: yup
.number()
.nullable()
.when(['maxAge', 'age'], {
is: (maxAge, age) => maxAge !== undefined || age !== undefined,
then: yup.number().required('Минимальный возраст обязателен').min(0, 'Возраст не может быть меньше 0'),
}),
maxAge: yup
.number()
.nullable()
.when(['minAge', 'age'], {
is: (minAge, age) => minAge !== undefined || age !== undefined,
then: yup.number().required('Максимальный возраст обязателен').min(0, 'Возраст не может быть меньше 0'),
}),
age: yup
.number()
.nullable()
.when(['minAge', 'maxAge'], {
is: (minAge, maxAge) => minAge !== undefined && maxAge !== undefined,
then: yup
.number()
.required('Возраст обязателен')
.min(yup.ref('minAge'), 'Возраст не может быть меньше минимального')
.max(yup.ref('maxAge'), 'Возраст не может быть больше максимального'),
}),
}); 9. Динамическая валидация списка объектов
Каждый объект в списке должен содержать уникальную комбинацию "ID" и "Типа".

tsx
Копировать код
const schema = yup.object({
items: yup
.array()
.of(
yup.object({
id: yup.string().required('ID обязателен'),
type: yup.string().required('Тип обязателен'),
})
)
.test('unique-combinations', 'Комбинации ID и типа должны быть уникальны', function (value) {
const combinations = value.map(item => `${item.id}-${item.type}`);
return new Set(combinations).size === combinations.length;
}),
}); 10. Зависимость от внешнего контекста
Поле "Целевая сумма" должно быть больше "Начальной суммы", которая передается в контексте (context.startAmount).

tsx
Копировать код
const schema = yup.object({
targetAmount: yup
.number()
.required('Укажите целевую сумму')
.test('greater-than-start', 'Целевая сумма должна быть больше начальной', function (value) {
const { startAmount } = this.options.context;
return value > startAmount;
}),
}); 11. Проверка соответствия структуры вложенных объектов
Если указаны "Данные пользователя", то в них обязательно должны быть указаны "Имя", "Email" и "Роль".

tsx
Копировать код
const schema = yup.object({
userData: yup
.object()
.nullable()
.test('has-required-fields', 'Если указаны данные пользователя, то они должны быть полными', function (value) {
if (!value) return true;
const { name, email, role } = value;
return !!name && !!email && !!role;
}),
}); 12. Проверка взаимосвязанности полей по флагу
Если указан флаг "Детали обязательны", то все связанные поля "Описание", "Причина", "Источник" становятся обязательными.

tsx
Копировать код
const schema = yup.object({
detailsRequired: yup
.boolean()
.required('Укажите, обязательны ли детали'),
description: yup
.string()
.nullable()
.when('detailsRequired', {
is: true,
then: yup.string().required('Описание обязательно'),
}),
reason: yup
.string()
.nullable()
.when('detailsRequired', {
is: true,
then: yup.string().required('Причина обязательна'),
}),
source: yup
.string()
.nullable()
.when('detailsRequired', {
is: true,
then: yup.string().required('Источник обязателен'),
}),
}); 13. Сложная валидация ввода по условию
Если "Категория" = "Финансы", то поле "Сумма" обязательно, а "Описание" должно содержать слово "оплата".

tsx
Копировать код
const schema = yup.object({
category: yup.string().required('Категория обязательна'),
amount: yup
.number()
.nullable()
.when('category', {
is: 'finance',
then: yup.number().required('Сумма обязательна для категории Финансы'),
}),
description: yup
.string()
.nullable()
.when('category', {
is: 'finance',
then: yup.string().test('contains-payment', 'Описание должно содержать слово "оплата"', value => value && value.includes('оплата')),
}),
});
